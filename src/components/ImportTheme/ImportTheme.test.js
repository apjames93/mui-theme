/* eslint-disable no-undef */
import React from 'react';
import { mount } from 'enzyme';
import { act } from 'react-dom/test-utils';
import renderer from 'react-test-renderer';
import ImportTheme from './ImportTheme';

function setup() {
  const props = {
    setState: jest.fn(),
    theme: { primary: 'asdf' },
    accessToken: '1234',
    pageRedirect: '/',
  };

  const comp = mount(<ImportTheme {...props} />);
  return { comp, props };
}

describe('<ImportTheme />', () => {
  it('renders ImportTheme', () => {
    const { comp } = setup();
    expect(comp).toBeDefined();
  });

  it('should handleSubmit and take imported theme value and decode it', async () => {
    const { comp, props } = setup();
    global.URL.createObjectURL = jest.fn(() => 'details');
    const field = {
      input: {
        onChange: jest.fn(),
      },
    };
    const file = new File([], 'test.json', { type: 'application/json' });
    const iconBtn = comp.find('ForwardRef(IconButton)').first();
    iconBtn.simulate('click');
    const dialogOpen = comp.find('WithStyles(ForwardRef(Dialog))').first().prop('open');
    expect(dialogOpen).toEqual(true);
    act(() => {
      const { onDrop } = comp.find('[data-testid="DropzoneInput"]').first().props();
      onDrop([file], [], field, jest.fn());
    });
    const importTheme = 'data:application/json;base64,eyJwYWxldHRlIjp7ImNvbW1vbiI6eyJibGFjayI6IiMwMDAiLCJ3aGl0ZSI6IiNmZmYifSwidHlwZSI6ImxpZ2h0IiwicHJpbWFyeSI6eyJsaWdodCI6IiM4OGJjODYiLCJtYWluIjoiIzcwYWU2ZSIsImRhcmsiOiIjM2U4NTVlIiwiY29udHJhc3RUZXh0IjoiI2ZlZmVmZiJ9LCJzZWNvbmRhcnkiOnsibGlnaHQiOiIjZmY0MDgxIiwibWFpbiI6IiNmNTAwNTciLCJkYXJrIjoiI2M1MTE2MiIsImNvbnRyYXN0VGV4dCI6IiNmZmYifSwiZXJyb3IiOnsibGlnaHQiOiIjZTU3MzczIiwibWFpbiI6IiNmNDQzMzYiLCJkYXJrIjoiI2QzMmYyZiIsImNvbnRyYXN0VGV4dCI6IiNmZmYifSwid2FybmluZyI6eyJsaWdodCI6IiNmZmI3NGQiLCJtYWluIjoiI2ZmOTgwMCIsImRhcmsiOiIjZjU3YzAwIiwiY29udHJhc3RUZXh0IjoicmdiYSgwLCAwLCAwLCAwLjg3KSJ9LCJpbmZvIjp7ImxpZ2h0IjoiIzY0YjVmNiIsIm1haW4iOiIjMjE5NmYzIiwiZGFyayI6IiMxOTc2ZDIiLCJjb250cmFzdFRleHQiOiIjZmZmIn0sInN1Y2Nlc3MiOnsibGlnaHQiOiIjODFjNzg0IiwibWFpbiI6IiM0Y2FmNTAiLCJkYXJrIjoiIzM4OGUzYyIsImNvbnRyYXN0VGV4dCI6InJnYmEoMCwgMCwgMCwgMC44NykifSwiZ3JleSI6eyI1MCI6IiNmYWZhZmEiLCIxMDAiOiIjZjVmNWY1IiwiMjAwIjoiI2VlZWVlZSIsIjMwMCI6IiNlMGUwZTAiLCI0MDAiOiIjYmRiZGJkIiwiNTAwIjoiIzllOWU5ZSIsIjYwMCI6IiM3NTc1NzUiLCI3MDAiOiIjNjE2MTYxIiwiODAwIjoiIzQyNDI0MiIsIjkwMCI6IiMyMTIxMjEiLCJBMTAwIjoiI2Q1ZDVkNSIsIkEyMDAiOiIjYWFhYWFhIiwiQTQwMCI6IiMzMDMwMzAiLCJBNzAwIjoiIzYxNjE2MSJ9LCJjb250cmFzdFRocmVzaG9sZCI6MywidG9uYWxPZmZzZXQiOjAuMiwidGV4dCI6eyJwcmltYXJ5IjoicmdiYSgwLCAwLCAwLCAwLjg3KSIsInNlY29uZGFyeSI6InJnYmEoMCwgMCwgMCwgMC41NCkiLCJkaXNhYmxlZCI6InJnYmEoMCwgMCwgMCwgMC4zOCkiLCJoaW50IjoicmdiYSgwLCAwLCAwLCAwLjM4KSJ9LCJkaXZpZGVyIjoicmdiYSgwLCAwLCAwLCAwLjEyKSJ9LCJiYWNrZ3JvdW5kIjp7InBhcGVyIjoiI2ZmZiIsImRlZmF1bHQiOiIjZmFmYWZhIn0sImFjdGlvbiI6eyJhY3RpdmUiOiJyZ2JhKDAsIDAsIDAsIDAuNTQpLCIsImhvdmVyIjoicmdiYSgwLCAwLCAwLCAwLjA0KSwiLCJob3Zlck9wYWNpdHkiOjAuMDQsInNlbGVjdGVkIjoicmdiYSgwLCAwLCAwLCAwLjA4KSwiLCJzZWxlY3RlZE9wYWNpdHkiOjAuMDgsImRpc2FibGVkIjoicmdiYSgwLCAwLCAwLCAwLjI2KSIsImRpc2FibGVkQmFja2dyb3VuZCI6InJnYmEoMCwgMCwgMCwgMC4xMikiLCJkaXNhYmxlZE9wYWNpdHkiOjAuMzgsImZvY3VzIjoicmdiYSgwLCAwLCAwLCAwLjEyKSIsImZvY3VzT3BhY2l0eSI6MC4xMiwiYWN0aXZhdGVkT3BhY2l0eSI6MC4xMn0sInNoYWRvd3MiOlsibm9uZSIsIjBweCAycHggMXB4IC0xcHggcmdiYSgwLDAsMCwwLjIpLDBweCAxcHggMXB4IDBweCByZ2JhKDAsMCwwLDAuMTQpLDBweCAxcHggM3B4IDBweCByZ2JhKDAsMCwwLDAuMTIpIiwiMHB4IDNweCAxcHggLTJweCByZ2JhKDAsMCwwLDAuMiksMHB4IDJweCAycHggMHB4IHJnYmEoMCwwLDAsMC4xNCksMHB4IDFweCA1cHggMHB4IHJnYmEoMCwwLDAsMC4xMikiLCIwcHggM3B4IDNweCAtMnB4IHJnYmEoMCwwLDAsMC4yKSwwcHggM3B4IDRweCAwcHggcmdiYSgwLDAsMCwwLjE0KSwwcHggMXB4IDhweCAwcHggcmdiYSgwLDAsMCwwLjEyKSIsIjBweCAycHggNHB4IC0xcHggcmdiYSgwLDAsMCwwLjIpLDBweCA0cHggNXB4IDBweCByZ2JhKDAsMCwwLDAuMTQpLDBweCAxcHggMTBweCAwcHggcmdiYSgwLDAsMCwwLjEyKSIsIjBweCAzcHggNXB4IC0xcHggcmdiYSgwLDAsMCwwLjIpLDBweCA1cHggOHB4IDBweCByZ2JhKDAsMCwwLDAuMTQpLDBweCAxcHggMTRweCAwcHggcmdiYSgwLDAsMCwwLjEyKSIsIjBweCAzcHggNXB4IC0xcHggcmdiYSgwLDAsMCwwLjIpLDBweCA2cHggMTBweCAwcHggcmdiYSgwLDAsMCwwLjE0KSwwcHggMXB4IDE4cHggMHB4IHJnYmEoMCwwLDAsMC4xMikiLCIwcHggNHB4IDVweCAtMnB4IHJnYmEoMCwwLDAsMC4yKSwwcHggN3B4IDEwcHggMXB4IHJnYmEoMCwwLDAsMC4xNCksMHB4IDJweCAxNnB4IDFweCByZ2JhKDAsMCwwLDAuMTIpIiwiMHB4IDVweCA1cHggLTNweCByZ2JhKDAsMCwwLDAuMiksMHB4IDhweCAxMHB4IDFweCByZ2JhKDAsMCwwLDAuMTQpLDBweCAzcHggMTRweCAycHggcmdiYSgwLDAsMCwwLjEyKSIsIjBweCA1cHggNnB4IC0zcHggcmdiYSgwLDAsMCwwLjIpLDBweCA5cHggMTJweCAxcHggcmdiYSgwLDAsMCwwLjE0KSwwcHggM3B4IDE2cHggMnB4IHJnYmEoMCwwLDAsMC4xMikiLCIwcHggNnB4IDZweCAtM3B4IHJnYmEoMCwwLDAsMC4yKSwwcHggMTBweCAxNHB4IDFweCByZ2JhKDAsMCwwLDAuMTQpLDBweCA0cHggMThweCAzcHggcmdiYSgwLDAsMCwwLjEyKSIsIjBweCA2cHggN3B4IC00cHggcmdiYSgwLDAsMCwwLjIpLDBweCAxMXB4IDE1cHggMXB4IHJnYmEoMCwwLDAsMC4xNCksMHB4IDRweCAyMHB4IDNweCByZ2JhKDAsMCwwLDAuMTIpIiwiMHB4IDdweCA4cHggLTRweCByZ2JhKDAsMCwwLDAuMiksMHB4IDEycHggMTdweCAycHggcmdiYSgwLDAsMCwwLjE0KSwwcHggNXB4IDIycHggNHB4IHJnYmEoMCwwLDAsMC4xMikiLCIwcHggN3B4IDhweCAtNHB4IHJnYmEoMCwwLDAsMC4yKSwwcHggMTNweCAxOXB4IDJweCByZ2JhKDAsMCwwLDAuMTQpLDBweCA1cHggMjRweCA0cHggcmdiYSgwLDAsMCwwLjEyKSIsIjBweCA3cHggOXB4IC00cHggcmdiYSgwLDAsMCwwLjIpLDBweCAxNHB4IDIxcHggMnB4IHJnYmEoMCwwLDAsMC4xNCksMHB4IDVweCAyNnB4IDRweCByZ2JhKDAsMCwwLDAuMTIpIiwiMHB4IDhweCA5cHggLTVweCByZ2JhKDAsMCwwLDAuMiksMHB4IDE1cHggMjJweCAycHggcmdiYSgwLDAsMCwwLjE0KSwwcHggNnB4IDI4cHggNXB4IHJnYmEoMCwwLDAsMC4xMikiLCIwcHggOHB4IDEwcHggLTVweCByZ2JhKDAsMCwwLDAuMiksMHB4IDE2cHggMjRweCAycHggcmdiYSgwLDAsMCwwLjE0KSwwcHggNnB4IDMwcHggNXB4IHJnYmEoMCwwLDAsMC4xMikiLCIwcHggOHB4IDExcHggLTVweCByZ2JhKDAsMCwwLDAuMiksMHB4IDE3cHggMjZweCAycHggcmdiYSgwLDAsMCwwLjE0KSwwcHggNnB4IDMycHggNXB4IHJnYmEoMCwwLDAsMC4xMikiLCIwcHggOXB4IDExcHggLTVweCByZ2JhKDAsMCwwLDAuMiksMHB4IDE4cHggMjhweCAycHggcmdiYSgwLDAsMCwwLjE0KSwwcHggN3B4IDM0cHggNnB4IHJnYmEoMCwwLDAsMC4xMikiLCIwcHggOXB4IDEycHggLTZweCByZ2JhKDAsMCwwLDAuMiksMHB4IDE5cHggMjlweCAycHggcmdiYSgwLDAsMCwwLjE0KSwwcHggN3B4IDM2cHggNnB4IHJnYmEoMCwwLDAsMC4xMikiLCIwcHggMTBweCAxM3B4IC02cHggcmdiYSgwLDAsMCwwLjIpLDBweCAyMHB4IDMxcHggM3B4IHJnYmEoMCwwLDAsMC4xNCksMHB4IDhweCAzOHB4IDdweCByZ2JhKDAsMCwwLDAuMTIpIiwiMHB4IDEwcHggMTNweCAtNnB4IHJnYmEoMCwwLDAsMC4yKSwwcHggMjFweCAzM3B4IDNweCByZ2JhKDAsMCwwLDAuMTQpLDBweCA4cHggNDBweCA3cHggcmdiYSgwLDAsMCwwLjEyKSIsIjBweCAxMHB4IDE0cHggLTZweCByZ2JhKDAsMCwwLDAuMiksMHB4IDIycHggMzVweCAzcHggcmdiYSgwLDAsMCwwLjE0KSwwcHggOHB4IDQycHggN3B4IHJnYmEoMCwwLDAsMC4xMikiLCIwcHggMTFweCAxNHB4IC03cHggcmdiYSgwLDAsMCwwLjIpLDBweCAyM3B4IDM2cHggM3B4IHJnYmEoMCwwLDAsMC4xNCksMHB4IDlweCA0NHB4IDhweCByZ2JhKDAsMCwwLDAuMTIpIiwiMHB4IDExcHggMTVweCAtN3B4IHJnYmEoMCwwLDAsMC4yKSwwcHggMjRweCAzOHB4IDNweCByZ2JhKDAsMCwwLDAuMTQpLDBweCA5cHggNDZweCA4cHggcmdiYSgwLDAsMCwwLjEyKSJdLCJ0eXBvZ3JhcGh5Ijp7Imh0bWxGb250U2l6ZSI6MTYsImZvbnRGYW1pbHkiOiInUm9ib3RvJywgJ0hlbHZldGljYScsICdBcmlhbCcsICdzYW5zLXNlcmlmJyIsImZvbnRTaXplIjoxNCwiZm9udFdlaWdodExpZ2h0IjozMDAsImZvbnRXZWlnaHRSZWd1bGFyIjo0MDAsImZvbnRXZWlnaHRNZWRpdW0iOjUwMCwiZm9udFdlaWdodEJvbGQiOjcwMCwiaDEiOnsiZm9udEZhbWlseSI6IidSb2JvdG8nLCAnSGVsdmV0aWNhJywgJ0FyaWFsJywgJ3NhbnMtc2VyaWYnIiwiZm9udFdlaWdodCI6MzAwLCJmb250U2l6ZSI6IjZyZW0iLCJsaW5lSGVpZ2h0IjoxLjE2NywibGV0dGVyU3BhY2luZyI6Ii0wLjAxNTYyZW0ifSwiaDIiOnsiZm9udEZhbWlseSI6IidSb2JvdG8nLCAnSGVsdmV0aWNhJywgJ0FyaWFsJywgJ3NhbnMtc2VyaWYnIiwiZm9udFdlaWdodCI6MzAwLCJmb250U2l6ZSI6IjMuNzVyZW0iLCJsaW5lSGVpZ2h0IjoxLjIsImxldHRlclNwYWNpbmciOiItMC4wMDgzM2VtIn0sImgzIjp7ImZvbnRGYW1pbHkiOiInUm9ib3RvJywgJ0hlbHZldGljYScsICdBcmlhbCcsICdzYW5zLXNlcmlmJyIsImZvbnRXZWlnaHQiOjQwMCwiZm9udFNpemUiOiIzcmVtIiwibGluZUhlaWdodCI6MS4xNjcsImxldHRlclNwYWNpbmciOiIwZW0ifSwiaDQiOnsiZm9udEZhbWlseSI6IidSb2JvdG8nLCAnSGVsdmV0aWNhJywgJ0FyaWFsJywgJ3NhbnMtc2VyaWYnIiwiZm9udFdlaWdodCI6NDAwLCJmb250U2l6ZSI6IjIuMTI1cmVtIiwibGluZUhlaWdodCI6MS4yMzUsImxldHRlclNwYWNpbmciOiIwLjAwNzM1ZW0ifSwiaDUiOnsiZm9udEZhbWlseSI6IidSb2JvdG8nLCAnSGVsdmV0aWNhJywgJ0FyaWFsJywgJ3NhbnMtc2VyaWYnIiwiZm9udFdlaWdodCI6NDAwLCJmb250U2l6ZSI6IjEuNXJlbSIsImxpbmVIZWlnaHQiOjEuMzM0LCJsZXR0ZXJTcGFjaW5nIjoiMGVtIn0sImg2Ijp7ImZvbnRGYW1pbHkiOiInUm9ib3RvJywgJ0hlbHZldGljYScsICdBcmlhbCcsICdzYW5zLXNlcmlmJyIsImZvbnRXZWlnaHQiOjUwMCwiZm9udFNpemUiOiIxLjI1cmVtIiwibGluZUhlaWdodCI6MS42LCJsZXR0ZXJTcGFjaW5nIjoiMC4wMDc1ZW0ifSwic3VidGl0bGUxIjp7ImZvbnRGYW1pbHkiOiInUm9ib3RvJywgJ0hlbHZldGljYScsICdBcmlhbCcsICdzYW5zLXNlcmlmJyIsImZvbnRXZWlnaHQiOjQwMCwiZm9udFNpemUiOiIxcmVtIiwibGluZUhlaWdodCI6MS43NSwibGV0dGVyU3BhY2luZyI6IjAuMDA5MzhlbSJ9LCJzdWJ0aXRsZTIiOnsiZm9udEZhbWlseSI6IidSb2JvdG8nLCAnSGVsdmV0aWNhJywgJ0FyaWFsJywgJ3NhbnMtc2VyaWYnIiwiZm9udFdlaWdodCI6NTAwLCJmb250U2l6ZSI6IjAuODc1cmVtIiwibGluZUhlaWdodCI6MS41NywibGV0dGVyU3BhY2luZyI6IjAuMDA3MTRlbSJ9LCJib2R5MSI6eyJmb250RmFtaWx5IjoiJ1JvYm90bycsICdIZWx2ZXRpY2EnLCAnQXJpYWwnLCAnc2Fucy1zZXJpZiciLCJmb250V2VpZ2h0Ijo0MDAsImZvbnRTaXplIjoiMXJlbSIsImxpbmVIZWlnaHQiOjEuNSwibGV0dGVyU3BhY2luZyI6IjAuMDA5MzhlbSJ9LCJib2R5MiI6eyJmb250RmFtaWx5IjoiJ1JvYm90bycsICdIZWx2ZXRpY2EnLCAnQXJpYWwnLCAnc2Fucy1zZXJpZiciLCJmb250V2VpZ2h0Ijo0MDAsImZvbnRTaXplIjoiMC44NzVyZW0iLCJsaW5lSGVpZ2h0IjoxLjQzLCJsZXR0ZXJTcGFjaW5nIjoiMC4wMTA3MWVtIn0sImJ1dHRvbiI6eyJmb250RmFtaWx5IjoiJ1JvYm90bycsICdIZWx2ZXRpY2EnLCAnQXJpYWwnLCAnc2Fucy1zZXJpZiciLCJmb250V2VpZ2h0Ijo1MDAsImZvbnRTaXplIjoiMC44NzVyZW0iLCJsaW5lSGVpZ2h0IjoxLjc1LCJ0ZXh0VHJhbnNmb3JtIjoidXBwZXJjYXNlIn0sImNhcHRpb24iOnsiZm9udEZhbWlseSI6IidSb2JvdG8nLCAnSGVsdmV0aWNhJywgJ0FyaWFsJywgJ3NhbnMtc2VyaWYnIiwiZm9udFdlaWdodCI6NDAwLCJmb250U2l6ZSI6IjAuNzVyZW0iLCJsaW5lSGVpZ2h0IjoxLjY2LCJsZXR0ZXJTcGFjaW5nIjoiMC4wMzMzM2VtIn0sIm92ZXJsaW5lIjp7ImZvbnRGYW1pbHkiOiInUm9ib3RvJywgJ0hlbHZldGljYScsICdBcmlhbCcsICdzYW5zLXNlcmlmJyIsImZvbnRXZWlnaHQiOjQwMCwiZm9udFNpemUiOiIwLjc1cmVtIiwibGluZUhlaWdodCI6Mi42NiwibGV0dGVyU3BhY2luZyI6IjAuMDgzMzNlbSIsInRleHRUcmFuc2Zvcm0iOiJ1cHBlcmNhc2UifX0sInNoYXBlIjp7ImJvcmRlclJhZGl1cyI6NH0sInRyYW5zaXRpb25zIjp7ImVhc2luZyI6eyJlYXNlSW5PdXQiOiJjdWJpYy1iZXppZXIoMC40LCAwLCAwLjIsIDEpIiwiZWFzZU91dCI6ImN1YmljLWJlemllcigwLjAsIDAsIDAuMiwgMSkiLCJlYXNlSW4iOiJjdWJpYy1iZXppZXIoMC40LCAwLCAxLCAxKSIsInNoYXJwIjoiY3ViaWMtYmV6aWVyKDAuNCwgMCwgMC42LCAxKSJ9LCJkdXJhdGlvbiI6eyJzaG9ydGVzdCI6MTUwLCJzaG9ydGVyIjoyMDAsInNob3J0IjoyNTAsInN0YW5kYXJkIjozMDAsImNvbXBsZXgiOjM3NSwiZW50ZXJpbmdTY3JlZW4iOjIyNSwibGVhdmluZ1NjcmVlbiI6MTk1fX0sInpJbmRleCI6eyJtb2JpbGVTdGVwcGVyIjoxMDAwLCJzcGVlZERpYWwiOjEwNTAsImFwcEJhciI6MTEwMCwiZHJhd2VyIjoxMjAwLCJtb2RhbCI6MTMwMCwic25hY2tiYXIiOjE0MDAsInRvb2x0aXAiOjE1MDB9fQ==';
    const values = { importTheme };
    await comp.find('RffWrapper').props().onSubmit(values);
    const submitBtn = comp.find('MuiSubmit').first();
    await submitBtn.simulate('submit');
    setTimeout(() => {
      const closeDialog = comp.find('WithStyles(ForwardRef(Dialog))').first().props();
      expect(closeDialog.open).toEqual(false);
    }, 800);
    expect(props.setState).toHaveBeenCalled();
  });

  it('should handle close and close dialog when submitted or close is clicked', () => {
    const { comp } = setup();
    const dialog = comp.find('WithStyles(ForwardRef(Dialog))').first().props();
    expect(dialog.open).toEqual(false);
    const iconBtn = comp.find('ForwardRef(IconButton)').first();
    iconBtn.simulate('click');
    const dialogOpen = comp.find('WithStyles(ForwardRef(Dialog))').first().props();
    expect(dialogOpen.open).toEqual(true);
    const dialogClose = comp.find('WithStyles(ForwardRef(Dialog))').first().prop('onClose');
    act(() => {
      dialogClose();
    });
    setTimeout(() => {
      const closeDialog = comp.find('WithStyles(ForwardRef(Dialog))').first().props();
      expect(closeDialog.open).toEqual(false);
    }, 800);
  });

  test('snapshot', () => {
    const tree = renderer.create(<ImportTheme />);
    expect(tree).toMatchSnapshot();
  });
});
